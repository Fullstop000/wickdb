on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

name: Test

jobs:
  run-test:
    runs-on: ${{ matrix.os }}
    continue-on-error: ${{ matrix.experimental }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest]
        toolchain: [stable]
        experimental: [false]
        include:
          - os: ubuntu-latest
            toolchain: nightly
            experimental: true
          - os: macos-latest
            toolchain: nightly
            experimental: true
    steps:
      - uses: actions/checkout@v2
        name: Checkout 🛎️
      - uses: actions/cache@v2
        with:
          path: |
            ~/.cargo/registry
            ~/.cargo/git
            target
          key: ${{ runner.os }}-cargo-test
      - uses: actions-rs/toolchain@v1
        name: Setup Cargo Toolchain 🛎️
        with:
          components: rustfmt, clippy
          toolchain: ${{ matrix.toolchain }}
          override: true
          default: true
      - uses: actions-rs/cargo@v1
        name: Check Code Format 🔧
        with:
          command: fmt
          args: -- --check
      - uses: actions-rs/cargo@v1
        name: Run Cargo Clippy
        with:
          command: clippy
          args: -- -D warnings
      - uses: actions-rs/cargo@v1
        name: Running Tests 🚀
        with:
          command: test
          args: --all
  # latest-test:
  #   strategy:
  #     matrix:
  #       os: [ubuntu-latest, macos-latest]
  #   continue-on-error: true
  #   steps:
  #     - uses: actions/checkout@v2
  #       name: Checkout 🛎️
  #     - uses: actions/cache@v2
  #       with:
  #         path: |
  #           ~/.cargo/registry
  #           ~/.cargo/git
  #           target
  #         key: ${{ runner.os }}-cargo-test
  #     - uses: actions-rs/toolchain@v1
  #       name: Setup Cargo Toolchain 🛎️
  #       with:
  #         components: rustfmt, clippy
  #         toolchain: nightly
  #         override: true
  #     - uses: actions-rs/cargo@v1
  #       name: Check Code Format 🔧
  #       with:
  #         command: fmt
  #         args: -- --check
  #     - uses: actions-rs/cargo@v1
  #       name: Run Cargo Clippy
  #       with:
  #         command: clippy
  #         args: -- -D warnings
  #     - uses: actions-rs/cargo@v1
  #       name: Running Tests 🚀
  #       with:
  #         command: test
  #         args: --all
